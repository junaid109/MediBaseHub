<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:MediHub.App.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="800"
             x:Class="MediHub.App.Views.PatientProfileView"
             x:DataType="vm:PatientProfileViewModel">

    <UserControl.Styles>
        <Style Selector="TabItem">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
            <Setter Property="Margin" Value="0 0 24 0"/>
            <Setter Property="Padding" Value="0 0 0 12"/>
        </Style>
        <Style Selector="TabItem:selected">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0 0 0 2"/>
        </Style>
    </UserControl.Styles>

    <Grid RowDefinitions="Auto, *">
        <!-- Header Profile Card -->
        <Border Grid.Row="0" Classes="Card" Margin="0 0 0 24">
            <Grid ColumnDefinitions="Auto, *, Auto">
                <!-- Avatar & Info -->
                <StackPanel Orientation="Horizontal" Spacing="24">
                    <Border Width="80" Height="80" CornerRadius="40" Background="{DynamicResource PrimaryLightColor}">
                        <TextBlock Text="SJ" FontSize="32" FontWeight="Bold" Foreground="#0F172A" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Border>
                    
                    <StackPanel VerticalAlignment="Center" Spacing="4">
                        <TextBlock Text="{Binding SelectedPatient.FirstName, StringFormat='{}{0}'}" FontSize="24" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <StackPanel Orientation="Horizontal" Spacing="16">
                            <TextBlock Text="{Binding SelectedPatient.Gender}" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="â€¢" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="{Binding SelectedPatient.DateOfBirth, StringFormat='{}DOB: {0:MMM dd, yyyy}'}" Foreground="{DynamicResource TextSecondaryBrush}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Spacing="16" Margin="0 4 0 0">
                             <Border Background="#2010B981" CornerRadius="4" Padding="6 2">
                                <TextBlock Text="Active Patient" FontSize="11" Foreground="{DynamicResource PrimaryBrush}" FontWeight="SemiBold"/>
                             </Border>
                             <TextBlock Text="ID: #PT-89302" VerticalAlignment="Center" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- Actions -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                    <Button Classes="Primary" Content="Book Appointment"/>
                    <Button Content="Edit Profile"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Tabs -->
        <TabControl Grid.Row="1">
            <!-- Overview Tab -->
            <TabItem Header="Overview">
                <Grid ColumnDefinitions="2*, 24, *" Margin="0 24 0 0">
                    <!-- Left Column -->
                    <StackPanel Spacing="24">
                        <!-- Vitals -->
                        <Border Classes="Card">
                            <StackPanel Spacing="16">
                                <Grid ColumnDefinitions="*, Auto">
                                    <TextBlock Text="Latest Vitals" FontWeight="SemiBold" FontSize="16" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    <TextBlock Text="Today, 09:30 AM" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                </Grid>
                                
                                <ItemsControl ItemsSource="{Binding Vitals}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <UniformGrid Columns="4"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock Text="{Binding Name}" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                <TextBlock Text="{Binding Value}" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                <TextBlock Text="{Binding Unit}" FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!-- Active Problems -->
                         <Border Classes="Card">
                            <StackPanel Spacing="16">
                                <TextBlock Text="Active Problems" FontWeight="SemiBold" FontSize="16" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                <ItemsControl ItemsSource="{Binding Problems}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <Grid ColumnDefinitions="*, Auto">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Description}" FontWeight="Medium" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                        <TextBlock Text="{Binding DiagnosedDate, StringFormat='{}Diagnosed: {0:MMM yyyy}'}" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                    </StackPanel>
                                                    <Border Background="#20F59E0B" CornerRadius="4" Padding="6 2" VerticalAlignment="Top">
                                                        <TextBlock Text="{Binding Severity}" FontSize="11" Foreground="#F59E0B" FontWeight="SemiBold"/>
                                                    </Border>
                                                </Grid>
                                                <Border Height="1" Background="{DynamicResource SurfaceLightBrush}" Margin="0 8"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Right Column -->
                    <StackPanel Grid.Column="2" Spacing="24">
                        <!-- Contact Info -->
                         <Border Classes="Card">
                            <StackPanel Spacing="16">
                                <TextBlock Text="Contact Information" FontWeight="SemiBold" FontSize="16" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                <StackPanel Spacing="12">
                                    <Grid ColumnDefinitions="24, *">
                                        <PathIcon Data="{StaticResource IconUser}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                        <TextBlock Grid.Column="1" Text="{Binding SelectedPatient.PhoneNumber}" Margin="12 0 0 0" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="24, *">
                                        <PathIcon Data="{StaticResource IconDocument}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                        <TextBlock Grid.Column="1" Text="{Binding SelectedPatient.Email}" Margin="12 0 0 0" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    </Grid>
                                     <Grid ColumnDefinitions="24, *">
                                        <PathIcon Data="{StaticResource IconCalendar}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                        <TextBlock Grid.Column="1" Text="123 Wellness Ave, Suite 100, Health City" Margin="12 0 0 0" Foreground="{DynamicResource TextPrimaryBrush}" TextWrapping="Wrap"/>
                                    </Grid>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Recent Documents -->
                         <Border Classes="Card">
                            <StackPanel Spacing="16">
                                <Grid ColumnDefinitions="*, Auto">
                                    <TextBlock Text="Recent Documents" FontWeight="SemiBold" FontSize="16" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    <Button Classes="Link" Content="Upload" FontSize="12" Foreground="{DynamicResource PrimaryBrush}"/>
                                </Grid>
                                <ItemsControl ItemsSource="{Binding Documents}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#10FFFFFF" CornerRadius="6" Padding="8" Margin="0 4">
                                                <Grid ColumnDefinitions="Auto, *, Auto">
                                                     <PathIcon Data="{StaticResource IconDocument}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                     <TextBlock Grid.Column="1" Text="{Binding FileName}" Margin="12 0" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                     <TextBlock Grid.Column="2" Text="{Binding UploadedAt, StringFormat='{}{0:MMM dd}'}" FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </TabItem>
            
            <TabItem Header="Clinical History">
                <TextBlock Text="Clinical History Content Coming Soon" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="{DynamicResource TextSecondaryBrush}"/>
            </TabItem>
            
            <TabItem Header="Medications">
                <TextBlock Text="Medications List Coming Soon" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="{DynamicResource TextSecondaryBrush}"/>
            </TabItem>

             <TabItem Header="Lab Results">
                <TextBlock Text="Lab Results Content Coming Soon" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="{DynamicResource TextSecondaryBrush}"/>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
